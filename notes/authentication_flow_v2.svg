<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2006.8366782319265" height="2218.9877241349095"><desc>title%20Authentication%20Flows%0A%0Aparticipant%20Client%0Aparticipant%20AccessController%0Aparticipant%20AccessService%0Aparticipant%20KeyTokenService%0Aparticipant%20Database%0A%0Anote%20over%20Client%2CDatabase%3A%20Sign%20Up%20Flow%0AClient-%3EAccessController%3APOST%20%2Fshop%2Fsignup%20(name%2C%20email%2C%20password)%0AAccessController-%3EAccessService%3AsignUp(name%2C%20email%2C%20password)%0AAccessService-%3EDatabase%3ACheck%20if%20email%20exists%0AAccessService-%3EAccessService%3AHash%20password%0AAccessService-%3EDatabase%3ACreate%20new%20shop%0AAccessService-%3EKeyTokenService%3ACreate%20key%20pair%20and%20tokens%0AKeyTokenService-%3EDatabase%3AStore%20key%20pair%20and%20refresh%20token%0AAccessService--%3EClient%3AReturn%20user%20info%20and%20tokens%0A%0Anote%20over%20Client%2CDatabase%3A%20Login%20Flow%0AClient-%3EAccessController%3APOST%20%2Fshop%2Flogin%20(email%2C%20password)%0AAccessController-%3EAccessService%3Alogin(email%2C%20password)%0AAccessService-%3EDatabase%3AFind%20shop%20by%20email%0AAccessService-%3EAccessService%3AVerify%20password%0AAccessService-%3EKeyTokenService%3ACreate%20new%20key%20pair%20and%20tokens%0AKeyTokenService-%3EDatabase%3AUpdate%20key%20store%0AAccessService--%3EClient%3AReturn%20user%20info%20and%20new%20tokens%0A%0Anote%20over%20Client%2CDatabase%3A%20Authentication%20for%20Protected%20Routes%0AClient-%3EAccessController%3ARequest%20with%20access%20token%0AAccessController-%3EAuthUtils%3Aauthentication%20middleware%0AAuthUtils-%3EDatabase%3AFind%20key%20store%20by%20user%20ID%0AAuthUtils-%3EAuthUtils%3AVerify%20token%20with%20public%20key%0AAuthUtils--%3EAccessController%3AAllow%20request%20if%20token%20is%20valid%0AAccessController--%3EClient%3AHandle%20protected%20route%0A%0Anote%20over%20Client%2CDatabase%3A%20Logout%20Flow%0AClient-%3EAccessController%3APOST%20%2Fshop%2Flogout%20with%20access%20token%0AAccessController-%3EAuthUtils%3Aauthentication%20middleware%0AAuthUtils-%3EDatabase%3AFind%20key%20store%20by%20user%20ID%0AAuthUtils-%3EAuthUtils%3AVerify%20token%20with%20public%20key%0AAccessController-%3EAccessService%3Alogout(keyStore)%0AAccessService-%3EKeyTokenService%3AremoveKeyById(keyStore._id)%0AKeyTokenService-%3EDatabase%3ADelete%20key%20store%20entry%0AAccessService--%3EClient%3ALogout%20success%20response%0A%0Anote%20over%20Client%2CDatabase%3A%20Refresh%20Token%20Flow%0AClient-%3EAccessController%3APOST%20%2Fshop%2FhandlerRefreshToken%20with%20refresh%20token%0AAccessController-%3EAuthUtils%3Aauthentication%20middleware%0AAuthUtils-%3EDatabase%3AFind%20key%20store%20by%20user%20ID%0AAuthUtils-%3EAuthUtils%3AVerify%20refresh%20token%20with%20private%20key%0AAccessController-%3EAccessService%3AhandlerRefreshToken(refreshToken%2C%20user%2C%20keyStore)%0AAccessService-%3EAccessService%3ACheck%20if%20refresh%20token%20is%20used%0AAccessService-%3EAccessService%3AGenerate%20new%20tokens%0AAccessService-%3EKeyTokenService%3AUpdate%20key%20store%20with%20new%20refresh%20token%0AKeyTokenService-%3EDatabase%3AUpdate%20key%20store%0AAccessService--%3EClient%3AReturn%20new%20tokens</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2006" height="2218"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 88.3745921749091 L 45.10896188422168 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 88.3745921749091 L 464.29543487499313 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 88.3745921749091 L 877.1912050459404 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1215.0637246370536 88.3745921749091 L 1215.0637246370536 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1491.4246208455984 88.3745921749091 L 1491.4246208455984 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 88.3745921749091 L 1713.2506316476492 2218.9877241349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 47.662239334909096 L 82.67859916844336 47.662239334909096 L 82.67859916844336 88.3745921749091 L 7.5393246000000005 88.3745921749091 L 7.5393246000000005 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="23.899658982" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 386.8071936936767 47.662239334909096 L 541.7836760563096 47.662239334909096 L 541.7836760563096 88.3745921749091 L 386.8071936936767 88.3745921749091 L 386.8071936936767 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="403.1675280756767" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AccessController</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 808.6680784581298 47.662239334909096 L 945.7143316337509 47.662239334909096 L 945.7143316337509 88.3745921749091 L 808.6680784581298 88.3745921749091 L 808.6680784581298 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="825.0284128401298" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AccessService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1137.4940892601805 47.662239334909096 L 1292.6333600139267 47.662239334909096 L 1292.6333600139267 88.3745921749091 L 1137.4940892601805 88.3745921749091 L 1137.4940892601805 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1153.8544236421806" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">KeyTokenService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1440.1049854687253 47.662239334909096 L 1542.7442562224714 47.662239334909096 L 1542.7442562224714 88.3745921749091 L 1440.1049854687253 88.3745921749091 L 1440.1049854687253 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1456.4653198507253" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Database</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1663.5879710632566 47.662239334909096 L 1762.9132922320418 47.662239334909096 L 1762.9132922320418 88.3745921749091 L 1663.5879710632566 88.3745921749091 L 1663.5879710632566 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1679.9483054452567" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthUtils</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="891.6627883911133" y="22.75505242909091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication Flows</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.538177604221676 118.53189057490908 L 1491.4246208455984 118.53189057490908 L 1504.9954051255984 132.10267485490908 L 1504.9954051255984 153.2127837349091 L 31.538177604221676 153.2127837349091 L 31.538177604221676 118.53189057490908 M 1491.4246208455984 118.53189057490908 L 1491.4246208455984 132.10267485490908 L 1504.9954051255984 132.10267485490908" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="720.8772564146537" y="139.6419994549091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Sign Up Flow</text></g><g><rect fill="white" stroke="none" x="90.65551559311326" y="175.83075753490908" width="328.09335794359373" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="92.91731297311327" y="189.40154181490908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/signup (name, email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 195.4330014949091 L 451.88068036699315 195.4330014949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(464.29543487499313,195.4330014949091) translate(-464.29543487499313,-195.4330014949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.72989387499314 189.1502309949091 L 464.29543487499313 195.4330014949091 L 451.72989387499314 201.7157719949091 Z"/></g></g><g><rect fill="white" stroke="none" x="552.4931497777325" y="218.05097529490908" width="236.50034036546876" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="554.7549471577324" y="231.62175957490908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signUp(name, email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 237.6532192549091 L 864.7764505379404 237.6532192549091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,237.6532192549091) translate(-877.1912050459404,-237.6532192549091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.6256640459403 231.3704487549091 L 877.1912050459404 237.6532192549091 L 864.6256640459403 243.9359897549091 Z"/></g></g><g><rect fill="white" stroke="none" x="1106.4298373942302" y="260.2711930549091" width="155.75615396410157" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1108.6916347742301" y="273.8419773349091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Check if email exists</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 279.8734370149091 L 1479.0098663375984 279.8734370149091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,279.8734370149091) translate(-1491.4246208455984,-279.8734370149091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 273.59066651490906 L 1491.4246208455984 279.8734370149091 L 1478.8590798455984 286.1562075149091 Z"/></g></g><g><rect fill="white" stroke="none" x="895.0342732659404" y="302.49141081490905" width="115.6980103483789" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.2960706459404" y="316.06219509490904" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Hash password</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 322.09365477490906 L 937.5058018459404 322.09365477490906 L 937.5058018459404 341.69589873490906 L 889.6059595539404 341.69589873490906" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,341.69589873490906) translate(-877.1912050459404,-341.69589873490906)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 889.7567460459404 335.41312823490904 L 877.1912050459404 341.69589873490906 L 889.7567460459404 347.9786692349091 Z"/></g></g><g><rect fill="white" stroke="none" x="1120.2961155657695" y="364.31387253490914" width="128.02359476" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1122.5579129457694" y="377.88465681490914" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create new shop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 383.9161164949091 L 1479.0098663375984 383.9161164949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,383.9161164949091) translate(-1491.4246208455984,-383.9161164949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 377.63334599490906 L 1491.4246208455984 383.9161164949091 L 1478.8590798455984 390.1988869949091 Z"/></g></g><g><rect fill="white" stroke="none" x="945.0924111596171" y="406.5340902949091" width="202.0701035490625" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="947.354208539617" y="420.1048745749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create key pair and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 426.1363342549091 L 1202.6489701290536 426.1363342549091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1215.0637246370536,426.1363342549091) translate(-1215.0637246370536,-426.1363342549091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.4981836370537 419.8535637549091 L 1215.0637246370536 426.1363342549091 L 1202.4981836370537 432.41910475490914 Z"/></g></g><g><rect fill="white" stroke="none" x="1232.9067928570537" y="448.7543080549092" width="240.6747635832422" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1235.1685902370536" y="462.3250923349092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Store key pair and refresh token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1215.0637246370536 468.35655201490914 L 1479.0098663375984 468.35655201490914" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,468.35655201490914) translate(-1491.4246208455984,-468.35655201490914)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 462.0737815149091 L 1491.4246208455984 468.35655201490914 L 1478.8590798455984 474.63932251490917 Z"/></g></g><g><rect fill="white" stroke="none" x="357.42898509020796" y="490.97452581490916" width="207.44220437914063" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="359.690782470208" y="504.54531009490915" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return user info and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 510.57676977490917 L 57.52371639222168 510.57676977490917" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.10896188422168,510.57676977490917) translate(-45.10896188422168,-510.57676977490917)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.67450288422168 504.29399927490914 L 45.10896188422168 510.57676977490917 L 57.67450288422168 516.8595402749091 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.538177604221676 533.1947435749092 L 1491.4246208455984 533.1947435749092 L 1504.9954051255984 546.7655278549092 L 1504.9954051255984 567.8756367349092 L 31.538177604221676 567.8756367349092 L 31.538177604221676 533.1947435749092 M 1491.4246208455984 533.1947435749092 L 1491.4246208455984 546.7655278549092 L 1504.9954051255984 546.7655278549092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="729.4412088606376" y="554.3048524549092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login Flow</text></g><g><rect fill="white" stroke="none" x="122.69621269089158" y="590.4936105349092" width="264.01196756273436" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="124.95801007089159" y="604.0643948149092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/login (email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 610.0958544949092 L 451.88068036699315 610.0958544949092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(464.29543487499313,610.0958544949092) translate(-464.29543487499313,-610.0958544949092)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.72989387499314 603.8130839949092 L 464.29543487499313 610.0958544949092 L 451.72989387499314 616.3786249949092 Z"/></g></g><g><rect fill="white" stroke="none" x="585.2547769749981" y="632.7138282949091" width="170.9770859709375" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="587.516574354998" y="646.2846125749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">login(email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 652.3160722549092 L 864.7764505379404 652.3160722549092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,652.3160722549092) translate(-877.1912050459404,-652.3160722549092)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.6256640459403 646.0333017549092 L 877.1912050459404 652.3160722549092 L 864.6256640459403 658.5988427549091 Z"/></g></g><g><rect fill="white" stroke="none" x="1113.249603915684" y="674.9340460549091" width="142.116612338125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1115.511401295684" y="688.5048303349091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find shop by email</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 694.5362900149091 L 1479.0098663375984 694.5362900149091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,694.5362900149091) translate(-1491.4246208455984,-694.5362900149091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 688.2535195149092 L 1491.4246208455984 694.5362900149091 L 1478.8590798455984 700.8190605149091 Z"/></g></g><g><rect fill="white" stroke="none" x="895.0342732659404" y="717.1542638149091" width="120.33755197435546" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.2960706459404" y="730.7250480949091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify password</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 736.7565077749091 L 937.5058018459404 736.7565077749091 L 937.5058018459404 756.3587517349091 L 889.6059595539404 756.3587517349091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,756.3587517349091) translate(-877.1912050459404,-756.3587517349091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 889.7567460459404 750.0759812349091 L 877.1912050459404 756.3587517349091 L 889.7567460459404 762.6415222349091 Z"/></g></g><g><rect fill="white" stroke="none" x="927.615667461497" y="778.9767255349091" width="237.02359476" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="929.8774648414969" y="792.5475098149091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create new key pair and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 798.5789694949091 L 1202.6489701290536 798.5789694949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1215.0637246370536,798.5789694949091) translate(-1215.0637246370536,-798.5789694949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.4981836370537 792.2961989949091 L 1215.0637246370536 798.5789694949091 L 1202.4981836370537 804.861739994909 Z"/></g></g><g><rect fill="white" stroke="none" x="1288.4242355603008" y="821.196943294909" width="129.6398743620508" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.6860329403007" y="834.767727574909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update key store</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1215.0637246370536 840.799187254909 L 1479.0098663375984 840.799187254909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,840.799187254909) translate(-1491.4246208455984,-840.799187254909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 834.5164167549091 L 1491.4246208455984 840.799187254909 L 1478.8590798455984 847.081957754909 Z"/></g></g><g><rect fill="white" stroke="none" x="339.95224139208784" y="863.417161054909" width="242.39568033128907" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="342.21403877208786" y="876.987945334909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return user info and new tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 883.019405014909 L 57.52371639222168 883.019405014909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.10896188422168,883.019405014909) translate(-45.10896188422168,-883.019405014909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.67450288422168 876.736634514909 L 45.10896188422168 883.019405014909 L 57.67450288422168 889.302175514909 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.538177604221676 905.6373788149091 L 1491.4246208455984 905.6373788149091 L 1504.9954051255984 919.2081630949091 L 1504.9954051255984 940.3182719749091 L 31.538177604221676 940.3182719749091 L 31.538177604221676 905.6373788149091 M 1491.4246208455984 905.6373788149091 L 1491.4246208455984 919.2081630949091 L 1504.9954051255984 919.2081630949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="637.2609777662773" y="926.7474876949091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication for Protected Routes</text></g><g><rect fill="white" stroke="none" x="154.9578437028545" y="962.936245774909" width="199.48871316820313" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="157.21964108285448" y="976.507030054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Request with access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 982.538489734909 L 451.88068036699315 982.538489734909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(464.29543487499313,982.538489734909) translate(-464.29543487499313,-982.538489734909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.72989387499314 976.2557192349091 L 464.29543487499313 982.538489734909 L 451.72989387499314 988.821260234909 Z"/></g></g><g><rect fill="white" stroke="none" x="988.057748485081" y="1005.156463534909" width="201.430577181875" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.319545865081" y="1018.727247814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authentication middleware</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1024.758707494909 L 1700.8358771396493 1024.758707494909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1024.758707494909) translate(-1713.2506316476492,-1024.758707494909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1700.6850906476493 1018.475936994909 L 1713.2506316476492 1024.758707494909 L 1700.6850906476493 1031.041477994909 Z"/></g></g><g><rect fill="white" stroke="none" x="1509.2676890655985" y="1047.376681294909" width="186.13986673265626" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1511.5294864455984" y="1060.947465574909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find key store by user ID</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1066.978925254909 L 1503.8393753535984 1066.978925254909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,1066.978925254909) translate(-1491.4246208455984,-1066.978925254909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1503.9901618455983 1060.696154754909 L 1491.4246208455984 1066.978925254909 L 1503.9901618455983 1073.261695754909 Z"/></g></g><g><rect fill="white" stroke="none" x="1731.0936998676493" y="1089.596899054909" width="206.55847635179688" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1733.3554972476493" y="1103.167683334909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify token with public key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1109.1991430149092 L 1773.5652284476491 1109.1991430149092 L 1773.5652284476491 1128.801386974909 L 1725.6653861556492 1128.801386974909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1128.801386974909) translate(-1713.2506316476492,-1128.801386974909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1725.8161726476492 1122.518616474909 L 1713.2506316476492 1128.801386974909 L 1725.8161726476492 1135.084157474909 Z"/></g></g><g><rect fill="white" stroke="none" x="978.9356548075602" y="1151.4193607749091" width="219.6747635832422" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="981.1974521875602" y="1164.9901450549091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Allow request if token is valid</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1171.021604734909 L 476.7101893829931 1171.021604734909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(464.29543487499313,1171.021604734909) translate(-464.29543487499313,-1171.021604734909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 476.86097587499313 1164.738834234909 L 464.29543487499313 1171.021604734909 L 476.86097587499313 1177.304375234909 Z"/></g></g><g><rect fill="white" stroke="none" x="167.1555175004619" y="1193.639578534909" width="175.09335794359376" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="169.4173148804619" y="1207.210362814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Handle protected route</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1213.241822494909 L 57.52371639222168 1213.241822494909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.10896188422168,1213.241822494909) translate(-45.10896188422168,-1213.241822494909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.67450288422168 1206.959051994909 L 45.10896188422168 1213.241822494909 L 57.67450288422168 1219.524592994909 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.538177604221676 1235.8597962949088 L 1491.4246208455984 1235.8597962949088 L 1504.9954051255984 1249.4305805749088 L 1504.9954051255984 1270.540689454909 L 31.538177604221676 1270.540689454909 L 31.538177604221676 1235.8597962949088 M 1491.4246208455984 1235.8597962949088 L 1491.4246208455984 1249.4305805749088 L 1504.9954051255984 1249.4305805749088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="724.1214418623466" y="1256.969905174909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Logout Flow</text></g><g><rect fill="white" stroke="none" x="117.36481849533494" y="1293.158663254909" width="274.6747483244531" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="119.62661587533495" y="1306.729447534909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/logout with access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 1312.760907214909 L 451.88068036699315 1312.760907214909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(464.29543487499313,1312.760907214909) translate(-464.29543487499313,-1312.760907214909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.72989387499314 1306.478136714909 L 464.29543487499313 1312.760907214909 L 451.72989387499314 1319.0436777149089 Z"/></g></g><g><rect fill="white" stroke="none" x="988.057748485081" y="1335.378881014909" width="201.430577181875" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.319545865081" y="1348.949665294909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authentication middleware</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1354.9811249749089 L 1700.8358771396493 1354.9811249749089" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1354.9811249749089) translate(-1713.2506316476492,-1354.9811249749089)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1700.6850906476493 1348.698354474909 L 1713.2506316476492 1354.9811249749089 L 1700.6850906476493 1361.2638954749088 Z"/></g></g><g><rect fill="white" stroke="none" x="1509.2676890655985" y="1377.599098774909" width="186.13986673265626" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1511.5294864455984" y="1391.169883054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find key store by user ID</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1397.2013427349088 L 1503.8393753535984 1397.2013427349088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,1397.2013427349088) translate(-1491.4246208455984,-1397.2013427349088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1503.9901618455983 1390.9185722349089 L 1491.4246208455984 1397.2013427349088 L 1503.9901618455983 1403.4841132349088 Z"/></g></g><g><rect fill="white" stroke="none" x="1731.0936998676493" y="1419.819316534909" width="206.55847635179688" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1733.3554972476493" y="1433.390100814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify token with public key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1439.421560494909 L 1773.5652284476491 1439.421560494909 L 1773.5652284476491 1459.023804454909 L 1725.6653861556492 1459.023804454909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1459.023804454909) translate(-1713.2506316476492,-1459.023804454909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1725.8161726476492 1452.741033954909 L 1713.2506316476492 1459.023804454909 L 1725.8161726476492 1465.306574954909 Z"/></g></g><g><rect fill="white" stroke="none" x="607.4001283849102" y="1481.641778254909" width="126.68638315111328" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="609.6619257649102" y="1495.212562534909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">logout(keyStore)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1501.244022214909 L 864.7764505379404 1501.244022214909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,1501.244022214909) translate(-877.1912050459404,-1501.244022214909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.6256640459403 1494.961251714909 L 877.1912050459404 1501.244022214909 L 864.6256640459403 1507.5267927149089 Z"/></g></g><g><rect fill="white" stroke="none" x="935.9819470635478" y="1523.861996014909" width="220.29103555589845" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="938.2437444435477" y="1537.432780294909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">removeKeyById(keyStore._id)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 1543.4642399749089 L 1202.6489701290536 1543.4642399749089" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1215.0637246370536,1543.4642399749089) translate(-1215.0637246370536,-1543.4642399749089)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.4981836370537 1537.181469474909 L 1215.0637246370536 1543.4642399749089 L 1202.4981836370537 1549.7470104749088 Z"/></g></g><g><rect fill="white" stroke="none" x="1269.1858627575664" y="1566.082213774909" width="168.116612338125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1271.4476601375663" y="1579.652998054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Delete key store entry</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1215.0637246370536 1585.6844577349088 L 1479.0098663375984 1585.6844577349088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,1585.6844577349088) translate(-1491.4246208455984,-1585.6844577349088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 1579.4016872349089 L 1491.4246208455984 1585.6844577349088 L 1478.8590798455984 1591.9672282349088 Z"/></g></g><g><rect fill="white" stroke="none" x="367.18479678149214" y="1608.302431534909" width="187.930577181875" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="369.44659416149216" y="1621.873215814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Logout success response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 1627.9046754949088 L 57.52371639222168 1627.9046754949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.10896188422168,1627.9046754949088) translate(-45.10896188422168,-1627.9046754949088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.67450288422168 1621.6219049949088 L 45.10896188422168 1627.9046754949088 L 57.67450288422168 1634.1874459949088 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.538177604221676 1650.5226492949087 L 1491.4246208455984 1650.5226492949087 L 1504.9954051255984 1664.0934335749087 L 1504.9954051255984 1685.2035424549088 L 31.538177604221676 1685.2035424549088 L 31.538177604221676 1650.5226492949087 M 1491.4246208455984 1650.5226492949087 L 1491.4246208455984 1664.0934335749087 L 1504.9954051255984 1664.0934335749087" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="698.3539991590995" y="1671.6327581749088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Refresh Token Flow</text></g><g><rect fill="white" stroke="none" x="62.95203010422167" y="1707.8215162549088" width="383.50034036546873" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.21382748422167" y="1721.3923005349088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/handlerRefreshToken with refresh token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.10896188422168 1727.4237602149087 L 451.88068036699315 1727.4237602149087" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(464.29543487499313,1727.4237602149087) translate(-464.29543487499313,-1727.4237602149087)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 451.72989387499314 1721.1409897149088 L 464.29543487499313 1727.4237602149087 L 451.72989387499314 1733.7065307149087 Z"/></g></g><g><rect fill="white" stroke="none" x="988.057748485081" y="1750.0417340149088" width="201.430577181875" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="990.319545865081" y="1763.6125182949088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authentication middleware</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1769.6439779749087 L 1700.8358771396493 1769.6439779749087" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1769.6439779749087) translate(-1713.2506316476492,-1769.6439779749087)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1700.6850906476493 1763.3612074749087 L 1713.2506316476492 1769.6439779749087 L 1700.6850906476493 1775.9267484749087 Z"/></g></g><g><rect fill="white" stroke="none" x="1509.2676890655985" y="1792.2619517749088" width="186.13986673265626" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1511.5294864455984" y="1805.8327360549088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find key store by user ID</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1811.8641957349087 L 1503.8393753535984 1811.8641957349087" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,1811.8641957349087) translate(-1491.4246208455984,-1811.8641957349087)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1503.9901618455983 1805.5814252349087 L 1491.4246208455984 1811.8641957349087 L 1503.9901618455983 1818.1469662349086 Z"/></g></g><g><rect fill="white" stroke="none" x="1731.0936998676493" y="1834.4821695349087" width="270.46545877367186" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1733.3554972476493" y="1848.0529538149087" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify refresh token with private key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1713.2506316476492 1854.0844134949089 L 1773.5652284476491 1854.0844134949089 L 1773.5652284476491 1873.6866574549088 L 1725.6653861556492 1873.6866574549088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1713.2506316476492,1873.6866574549088) translate(-1713.2506316476492,-1873.6866574549088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1725.8161726476492 1867.4038869549088 L 1713.2506316476492 1873.6866574549088 L 1725.8161726476492 1879.9694279549087 Z"/></g></g><g><rect fill="white" stroke="none" x="482.13850309499315" y="1896.3046312549088" width="377.20962991625" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="484.4003004749932" y="1909.8754155349088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">handlerRefreshToken(refreshToken, user, keyStore)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 464.29543487499313 1915.9068752149087 L 864.7764505379404 1915.9068752149087" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,1915.9068752149087) translate(-877.1912050459404,-1915.9068752149087)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 864.6256640459403 1909.6241047149088 L 877.1912050459404 1915.9068752149087 L 864.6256640459403 1922.1896457149087 Z"/></g></g><g><rect fill="white" stroke="none" x="895.0342732659404" y="1938.5248490149088" width="221.616612338125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.2960706459404" y="1952.0956332949088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Check if refresh token is used</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 1958.127092974909 L 937.5058018459404 1958.127092974909 L 937.5058018459404 1977.7293369349088 L 889.6059595539404 1977.7293369349088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,1977.7293369349088) translate(-877.1912050459404,-1977.7293369349088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 889.7567460459404 1971.4465664349088 L 877.1912050459404 1977.7293369349088 L 889.7567460459404 1984.0121074349088 Z"/></g></g><g><rect fill="white" stroke="none" x="895.0342732659404" y="2000.347310734909" width="161.18639078050782" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.2960706459404" y="2013.9180950149089" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Generate new tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 2019.949554694909 L 937.5058018459404 2019.949554694909 L 937.5058018459404 2039.551798654909 L 889.6059595539404 2039.551798654909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(877.1912050459404,2039.551798654909) translate(-877.1912050459404,-2039.551798654909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 889.7567460459404 2033.269028154909 L 877.1912050459404 2039.551798654909 L 889.7567460459404 2045.8345691549089 Z"/></g></g><g><rect fill="white" stroke="none" x="895.0342732659403" y="2062.169772454909" width="302.18637552171873" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.2960706459403" y="2075.740556734909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update key store with new refresh token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 2081.772016414909 L 1202.6489701290536 2081.772016414909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1215.0637246370536,2081.772016414909) translate(-1215.0637246370536,-2081.772016414909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1202.4981836370537 2075.489245914909 L 1215.0637246370536 2081.772016414909 L 1202.4981836370537 2088.054786914909 Z"/></g></g><g><rect fill="white" stroke="none" x="1288.4242355603008" y="2104.389990214909" width="129.6398743620508" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1290.6860329403007" y="2117.9607744949094" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update key store</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1215.0637246370536 2123.9922341749093 L 1479.0098663375984 2123.9922341749093" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1491.4246208455984,2123.9922341749093) translate(-1491.4246208455984,-2123.9922341749093)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1478.8590798455984 2117.7094636749093 L 1491.4246208455984 2123.9922341749093 L 1478.8590798455984 2130.2750046749093 Z"/></g></g><g><rect fill="white" stroke="none" x="390.45805499072065" y="2146.6102079749094" width="141.38405313402345" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="392.7198523707207" y="2160.1809922549096" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return new tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 877.1912050459404 2166.2124519349095 L 57.52371639222168 2166.2124519349095" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.10896188422168,2166.2124519349095) translate(-45.10896188422168,-2166.2124519349095)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.67450288422168 2159.9296814349095 L 45.10896188422168 2166.2124519349095 L 57.67450288422168 2172.4952224349095 Z"/></g></g></g><g/><g/><g/><g/><g/><g/></g></svg>