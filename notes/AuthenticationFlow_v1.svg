<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1693.9357821595388" height="1680.6799476949088"><desc>title%20Authentication%20Flows%0A%0Aparticipant%20Client%0Aparticipant%20AccessController%0Aparticipant%20AccessService%0Aparticipant%20KeyTokenService%0Aparticipant%20Database%0A%0Anote%20over%20Client%2CDatabase%3A%20Sign%20Up%20Flow%0AClient-%3EAccessController%3A%20POST%20%2Fshop%2Fsignup%20(name%2C%20email%2C%20password)%0AAccessController-%3EAccessService%3A%20signUp(name%2C%20email%2C%20password)%0AAccessService-%3EDatabase%3A%20Check%20if%20email%20exists%0AAccessService-%3EAccessService%3A%20Hash%20password%0AAccessService-%3EDatabase%3A%20Create%20new%20shop%0AAccessService-%3EKeyTokenService%3A%20Create%20key%20pair%20and%20tokens%0AKeyTokenService-%3EDatabase%3A%20Store%20key%20pair%20and%20refresh%20token%0AAccessService--%3EClient%3A%20Return%20user%20info%20and%20tokens%0A%0Anote%20over%20Client%2CDatabase%3A%20Login%20Flow%0AClient-%3EAccessController%3A%20POST%20%2Fshop%2Flogin%20(email%2C%20password)%0AAccessController-%3EAccessService%3A%20login(email%2C%20password)%0AAccessService-%3EDatabase%3A%20Find%20shop%20by%20email%0AAccessService-%3EAccessService%3A%20Verify%20password%0AAccessService-%3EKeyTokenService%3A%20Create%20new%20key%20pair%20and%20tokens%0AKeyTokenService-%3EDatabase%3A%20Update%20key%20store%0AAccessService--%3EClient%3A%20Return%20user%20info%20and%20new%20tokens%0A%0Anote%20over%20Client%2CDatabase%3A%20Authentication%20for%20Protected%20Routes%0AClient-%3EAccessController%3A%20Request%20with%20access%20token%0AAccessController-%3EAuthUtils%3A%20authentication%20middleware%0AAuthUtils-%3EDatabase%3A%20Find%20key%20store%20by%20user%20ID%0AAuthUtils-%3EAuthUtils%3A%20Verify%20token%20with%20public%20key%0AAuthUtils--%3EAccessController%3A%20Allow%20request%20if%20token%20is%20valid%0AAccessController--%3EClient%3A%20Handle%20protected%20route%0A%0Anote%20over%20Client%2CDatabase%3A%20Logout%20Flow%0AClient-%3EAccessController%3A%20POST%20%2Fshop%2Flogout%20with%20access%20token%0AAccessController-%3EAuthUtils%3A%20authentication%20middleware%0AAuthUtils-%3EDatabase%3A%20Find%20key%20store%20by%20user%20ID%0AAuthUtils-%3EAuthUtils%3A%20Verify%20token%20with%20public%20key%0AAccessController-%3EAccessService%3A%20logout(keyStore)%0AAccessService-%3EKeyTokenService%3A%20removeKeyById(keyStore._id)%0AKeyTokenService-%3EDatabase%3A%20Delete%20key%20store%20entry%0AAccessService--%3EClient%3A%20Logout%20success%20response</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1693" height="1680"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.287718598088865 88.3745921749091 L 45.287718598088865 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 88.3745921749091 L 411.88551132152634 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 88.3745921749091 L 686.0803156111259 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 960.7825833559257 88.3745921749091 L 960.7825833559257 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1239.1564895894949 88.3745921749091 L 1239.1564895894949 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 88.3745921749091 L 1462.5304015451102 1680.6799476949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 47.662239334909096 L 83.03611259617773 47.662239334909096 L 83.03611259617773 88.3745921749091 L 7.5393246000000005 88.3745921749091 L 7.5393246000000005 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="23.899658982" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 333.89085000471187 47.662239334909096 L 489.8801726383408 47.662239334909096 L 489.8801726383408 88.3745921749091 L 333.89085000471187 88.3745921749091 L 333.89085000471187 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="350.2511843867119" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AccessController</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 617.1229658482665 47.662239334909096 L 755.0376653739853 47.662239334909096 L 755.0376653739853 88.3745921749091 L 617.1229658482665 88.3745921749091 L 617.1229658482665 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="633.4833002302665" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AccessService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 882.6909066582518 47.662239334909096 L 1038.8742600535995 47.662239334909096 L 1038.8742600535995 88.3745921749091 L 882.6909066582518 88.3745921749091 L 882.6909066582518 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="899.0512410402519" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">KeyTokenService</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1187.5274975231687 47.662239334909096 L 1290.785481655821 47.662239334909096 L 1290.785481655821 88.3745921749091 L 1187.5274975231687 88.3745921749091 L 1187.5274975231687 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1203.8878319051687" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Database</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1412.5879786926512 47.662239334909096 L 1512.4728243975692 47.662239334909096 L 1512.4728243975692 88.3745921749091 L 1412.5879786926512 88.3745921749091 L 1412.5879786926512 47.662239334909096 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1428.9483130746512" y="73.2959429749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthUtils</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="735.2388076782227" y="22.75505242909091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication Flows</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.716934318088864 118.53189057490908 L 1239.1564895894949 118.53189057490908 L 1252.7272738694949 132.10267485490908 L 1252.7272738694949 153.2127837349091 L 31.716934318088864 153.2127837349091 L 31.716934318088864 118.53189057490908 M 1239.1564895894949 118.53189057490908 L 1239.1564895894949 132.10267485490908 L 1252.7272738694949 132.10267485490908" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="594.4161339018364" y="139.6419994549091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Sign Up Flow</text></g><g><rect fill="white" stroke="none" x="63.13078681808886" y="175.83075753490908" width="330.9116562834375" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.39258419808885" y="189.40154181490908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/signup (name, email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.287718598088865 195.4330014949091 L 399.47075681352635 195.4330014949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(411.88551132152634,195.4330014949091) translate(-411.88551132152634,-195.4330014949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 399.31997032152634 189.1502309949091 L 411.88551132152634 195.4330014949091 L 399.31997032152634 201.7157719949091 Z"/></g></g><g><rect fill="white" stroke="none" x="429.72857954152636" y="218.05097529490908" width="238.50867166429688" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="431.9903769215264" y="231.62175957490908" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signUp(name, email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 237.6532192549091 L 673.6655611031259 237.6532192549091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(686.0803156111259,237.6532192549091) translate(-686.0803156111259,-237.6532192549091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 673.5147746111259 231.3704487549091 L 686.0803156111259 237.6532192549091 L 673.5147746111259 243.9359897549091 Z"/></g></g><g><rect fill="white" stroke="none" x="884.0954100375102" y="260.2711930549091" width="157.0459794035547" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="886.3572074175102" y="273.8419773349091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Check if email exists</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 279.8734370149091 L 1226.7417350814949 279.8734370149091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,279.8734370149091) translate(-1239.1564895894949,-279.8734370149091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 273.59066651490906 L 1239.1564895894949 279.8734370149091 L 1226.590948589495 286.1562075149091 Z"/></g></g><g><rect fill="white" stroke="none" x="703.923383831126" y="302.49141081490905" width="116.67284860521484" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="706.185181211126" y="316.06219509490904" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Hash password</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 322.09365477490906 L 746.3949124111259 322.09365477490906 L 746.3949124111259 341.69589873490906 L 698.4950701191259 341.69589873490906" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(686.0803156111259,341.69589873490906) translate(-686.0803156111259,-341.69589873490906)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 698.645856611126 335.41312823490904 L 686.0803156111259 341.69589873490906 L 698.645856611126 347.9786692349091 Z"/></g></g><g><rect fill="white" stroke="none" x="898.0804859881328" y="364.31387253490914" width="129.07583322435548" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="900.3422833681327" y="377.88465681490914" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create new shop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 383.9161164949091 L 1226.7417350814949 383.9161164949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,383.9161164949091) translate(-1239.1564895894949,-383.9161164949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 377.63334599490906 L 1239.1564895894949 383.9161164949091 L 1226.590948589495 390.1988869949091 Z"/></g></g><g><rect fill="white" stroke="none" x="721.5502492180888" y="406.5340902949091" width="203.76239480882813" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="723.8120465980887" y="420.1048745749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create key pair and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 426.1363342549091 L 948.3678288479257 426.1363342549091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(960.7825833559257,426.1363342549091) translate(-960.7825833559257,-426.1363342549091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 948.2170423559256 419.8535637549091 L 960.7825833559257 426.1363342549091 L 948.2170423559256 432.41910475490914 Z"/></g></g><g><rect fill="white" stroke="none" x="978.6256515759258" y="448.7543080549092" width="242.6877793303125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="980.8874489559257" y="462.3250923349092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Store key pair and refresh token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 960.7825833559257 468.35655201490914 L 1226.7417350814949 468.35655201490914" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,468.35655201490914) translate(-1239.1564895894949,-468.35655201490914)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 462.0737815149091 L 1239.1564895894949 468.35655201490914 L 1226.590948589495 474.63932251490917 Z"/></g></g><g><rect fill="white" stroke="none" x="261.0789370250224" y="490.97452581490916" width="209.2101639738672" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="263.34073440502243" y="504.54531009490915" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return user info and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 510.57676977490917 L 57.70247310608887 510.57676977490917" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.287718598088865,510.57676977490917) translate(-45.287718598088865,-510.57676977490917)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.85325959808887 504.29399927490914 L 45.287718598088865 510.57676977490917 L 57.85325959808887 516.8595402749091 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.716934318088864 533.1947435749092 L 1239.1564895894949 533.1947435749092 L 1252.7272738694949 546.7655278549092 L 1252.7272738694949 567.8756367349092 L 31.716934318088864 567.8756367349092 L 31.716934318088864 533.1947435749092 M 1239.1564895894949 533.1947435749092 L 1239.1564895894949 546.7655278549092 L 1252.7272738694949 546.7655278549092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="603.0579252455253" y="554.3048524549092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login Flow</text></g><g><rect fill="white" stroke="none" x="95.45168296677049" y="590.4936105349092" width="266.26987161546873" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="97.7134803467705" y="604.0643948149092" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/login (email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.287718598088865 610.0958544949092 L 399.47075681352635 610.0958544949092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(411.88551132152634,610.0958544949092) translate(-411.88551132152634,-610.0958544949092)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 399.31997032152634 603.8130839949092 L 411.88551132152634 610.0958544949092 L 399.31997032152634 616.3786249949092 Z"/></g></g><g><rect fill="white" stroke="none" x="462.77335455068163" y="632.7138282949091" width="172.41911783128907" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="465.03515193068165" y="646.2846125749091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">login(email, password)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 652.3160722549092 L 673.6655611031259 652.3160722549092" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(686.0803156111259,652.3160722549092) translate(-686.0803156111259,-652.3160722549092)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 673.5147746111259 646.0333017549092 L 686.0803156111259 652.3160722549092 L 673.5147746111259 658.5988427549091 Z"/></g></g><g><rect fill="white" stroke="none" x="890.9536196474955" y="674.9340460549091" width="143.32956399828126" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="893.2154170274955" y="688.5048303349091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find shop by email</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 694.5362900149091 L 1226.7417350814949 694.5362900149091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,694.5362900149091) translate(-1239.1564895894949,-694.5362900149091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 688.2535195149092 L 1239.1564895894949 694.5362900149091 L 1226.590948589495 700.8190605149091 Z"/></g></g><g><rect fill="white" stroke="none" x="703.923383831126" y="717.1542638149091" width="121.34448709398437" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="706.185181211126" y="730.7250480949091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify password</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 736.7565077749091 L 746.3949124111259 736.7565077749091 L 746.3949124111259 756.3587517349091 L 698.4950701191259 756.3587517349091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(686.0803156111259,756.3587517349091) translate(-686.0803156111259,-756.3587517349091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 698.645856611126 750.0759812349091 L 686.0803156111259 756.3587517349091 L 698.645856611126 762.6415222349091 Z"/></g></g><g><rect fill="white" stroke="none" x="703.9233838311259" y="778.9767255349091" width="239.01613321214845" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="706.1851812111258" y="792.5475098149091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Create new key pair and tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 798.5789694949091 L 948.3678288479257 798.5789694949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(960.7825833559257,798.5789694949091) translate(-960.7825833559257,-798.5789694949091)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 948.2170423559256 792.2961989949091 L 960.7825833559257 798.5789694949091 L 948.2170423559256 804.861739994909 Z"/></g></g><g><rect fill="white" stroke="none" x="1034.6181881207256" y="821.196943294909" width="130.70270242601563" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1036.8799855007255" y="834.767727574909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Update key store</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 960.7825833559257 840.799187254909 L 1226.7417350814949 840.799187254909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,840.799187254909) translate(-1239.1564895894949,-840.799187254909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 834.5164167549091 L 1239.1564895894949 840.799187254909 L 1226.590948589495 847.081957754909 Z"/></g></g><g><rect fill="white" stroke="none" x="243.45207163805955" y="863.417161054909" width="244.46388711839845" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="245.71386901805954" y="876.987945334909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return user info and new tokens</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 883.019405014909 L 57.70247310608887 883.019405014909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.287718598088865,883.019405014909) translate(-45.287718598088865,-883.019405014909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.85325959808887 876.736634514909 L 45.287718598088865 883.019405014909 L 57.85325959808887 889.302175514909 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.716934318088864 905.6373788149091 L 1239.1564895894949 905.6373788149091 L 1252.7272738694949 919.2081630949091 L 1252.7272738694949 940.3182719749091 L 31.716934318088864 940.3182719749091 L 31.716934318088864 905.6373788149091 M 1239.1564895894949 905.6373788149091 L 1239.1564895894949 919.2081630949091 L 1252.7272738694949 919.2081630949091" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="510.09523870682904" y="926.7474876949091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication for Protected Routes</text></g><g><rect fill="white" stroke="none" x="128.01138488632617" y="962.936245774909" width="201.15045633226563" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.27318226632616" y="976.507030054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Request with access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.287718598088865 982.538489734909 L 399.47075681352635 982.538489734909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(411.88551132152634,982.538489734909) translate(-411.88551132152634,-982.538489734909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 399.31997032152634 976.2557192349091 L 411.88551132152634 982.538489734909 L 399.31997032152634 988.821260234909 Z"/></g></g><g><rect fill="white" stroke="none" x="835.640189815037" y="1005.156463534909" width="203.1355332365625" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="837.901987195037" y="1018.727247814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authentication middleware</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 1024.758707494909 L 1450.1156470371102 1024.758707494909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1462.5304015451102,1024.758707494909) translate(-1462.5304015451102,-1024.758707494909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1449.9648605451102 1018.475936994909 L 1462.5304015451102 1024.758707494909 L 1449.9648605451102 1031.041477994909 Z"/></g></g><g><rect fill="white" stroke="none" x="1256.999557809495" y="1047.376681294909" width="187.6877793303125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1259.261355189495" y="1060.947465574909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find key store by user ID</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 1066.978925254909 L 1251.5712440974949 1066.978925254909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,1066.978925254909) translate(-1239.1564895894949,-1066.978925254909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1251.7220305894948 1060.696154754909 L 1239.1564895894949 1066.978925254909 L 1251.7220305894948 1073.261695754909 Z"/></g></g><g><rect fill="white" stroke="none" x="1480.3734697651103" y="1089.596899054909" width="208.28479471117188" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1482.6352671451102" y="1103.167683334909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify token with public key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 1109.1991430149092 L 1522.84499834511 1109.1991430149092 L 1522.84499834511 1128.801386974909 L 1474.9451560531102 1128.801386974909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1462.5304015451102,1128.801386974909) translate(-1462.5304015451102,-1128.801386974909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1475.0959425451101 1122.518616474909 L 1462.5304015451102 1128.801386974909 L 1475.0959425451101 1135.084157474909 Z"/></g></g><g><rect fill="white" stroke="none" x="826.4536225085185" y="1151.4193607749091" width="221.50867166429688" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="828.7154198885185" y="1164.9901450549091" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Allow request if token is valid</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 1171.021604734909 L 424.3002658295263 1171.021604734909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(411.88551132152634,1171.021604734909) translate(-411.88551132152634,-1171.021604734909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 424.45105232152633 1164.738834234909 L 411.88551132152634 1171.021604734909 L 424.45105232152633 1177.304375234909 Z"/></g></g><g><rect fill="white" stroke="none" x="140.30989257675586" y="1193.639578534909" width="176.55344095140626" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="142.57168995675585" y="1207.210362814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Handle protected route</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 1213.241822494909 L 57.70247310608887 1213.241822494909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.287718598088865,1213.241822494909) translate(-45.287718598088865,-1213.241822494909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.85325959808887 1206.959051994909 L 45.287718598088865 1213.241822494909 L 57.85325959808887 1219.524592994909 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 31.716934318088864 1235.8597962949088 L 1239.1564895894949 1235.8597962949088 L 1252.7272738694949 1249.4305805749088 L 1252.7272738694949 1270.540689454909 L 31.716934318088864 1270.540689454909 L 31.716934318088864 1235.8597962949088 M 1239.1564895894949 1235.8597962949088 L 1239.1564895894949 1249.4305805749088 L 1252.7272738694949 1249.4305805749088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="597.6922540876884" y="1256.969905174909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Logout Flow</text></g><g><rect fill="white" stroke="none" x="90.08600990158494" y="1293.158663254909" width="277.00119485765623" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="92.34780728158495" y="1306.729447534909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">POST /shop/logout with access token</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.287718598088865 1312.760907214909 L 399.47075681352635 1312.760907214909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(411.88551132152634,1312.760907214909) translate(-411.88551132152634,-1312.760907214909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 399.31997032152634 1306.478136714909 L 411.88551132152634 1312.760907214909 L 399.31997032152634 1319.0436777149089 Z"/></g></g><g><rect fill="white" stroke="none" x="835.640189815037" y="1335.378881014909" width="203.1355332365625" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="837.901987195037" y="1348.949665294909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">authentication middleware</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 1354.9811249749089 L 1450.1156470371102 1354.9811249749089" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1462.5304015451102,1354.9811249749089) translate(-1462.5304015451102,-1354.9811249749089)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1449.9648605451102 1348.698354474909 L 1462.5304015451102 1354.9811249749089 L 1449.9648605451102 1361.2638954749088 Z"/></g></g><g><rect fill="white" stroke="none" x="1256.999557809495" y="1377.599098774909" width="187.6877793303125" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1259.261355189495" y="1391.169883054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Find key store by user ID</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 1397.2013427349088 L 1251.5712440974949 1397.2013427349088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,1397.2013427349088) translate(-1239.1564895894949,-1397.2013427349088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1251.7220305894948 1390.9185722349089 L 1239.1564895894949 1397.2013427349088 L 1251.7220305894948 1403.4841132349088 Z"/></g></g><g><rect fill="white" stroke="none" x="1480.3734697651103" y="1419.819316534909" width="208.28479471117188" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1482.6352671451102" y="1433.390100814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Verify token with public key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1462.5304015451102 1439.421560494909 L 1522.84499834511 1439.421560494909 L 1522.84499834511 1459.023804454909 L 1474.9451560531102 1459.023804454909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1462.5304015451102,1459.023804454909) translate(-1462.5304015451102,-1459.023804454909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1475.0959425451101 1452.741033954909 L 1462.5304015451102 1459.023804454909 L 1475.0959425451101 1465.306574954909 Z"/></g></g><g><rect fill="white" stroke="none" x="485.1241007054668" y="1481.641778254909" width="127.71762552171874" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="487.3858980854668" y="1495.212562534909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">logout(keyStore)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 411.88551132152634 1501.244022214909 L 673.6655611031259 1501.244022214909" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(686.0803156111259,1501.244022214909) translate(-686.0803156111259,-1501.244022214909)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 673.5147746111259 1494.961251714909 L 686.0803156111259 1501.244022214909 L 673.5147746111259 1507.5267927149089 Z"/></g></g><g><rect fill="white" stroke="none" x="712.3860675087992" y="1523.861996014909" width="222.09076394945313" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="714.6478648887992" y="1537.432780294909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">removeKeyById(keyStore._id)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 1543.4642399749089 L 948.3678288479257 1543.4642399749089" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(960.7825833559257,1543.4642399749089) translate(-960.7825833559257,-1543.4642399749089)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 948.2170423559256 1537.181469474909 L 960.7825833559257 1543.4642399749089 L 948.2170423559256 1549.7470104749088 Z"/></g></g><g><rect fill="white" stroke="none" x="1015.2226650494365" y="1566.082213774909" width="169.49374856859376" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1017.4844624294365" y="1579.652998054909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Delete key store entry</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 960.7825833559257 1585.6844577349088 L 1226.7417350814949 1585.6844577349088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(1239.1564895894949,1585.6844577349088) translate(-1239.1564895894949,-1585.6844577349088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1226.590948589495 1579.4016872349089 L 1239.1564895894949 1585.6844577349088 L 1226.590948589495 1591.9672282349088 Z"/></g></g><g><rect fill="white" stroke="none" x="270.9446081828593" y="1608.302431534909" width="189.47882547289063" height="19.602243960000003"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="273.20640556285935" y="1621.873215814909" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Logout success response</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 686.0803156111259 1627.9046754949088 L 57.70247310608887 1627.9046754949088" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(45.287718598088865,1627.9046754949088) translate(-45.287718598088865,-1627.9046754949088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 57.85325959808887 1621.6219049949088 L 45.287718598088865 1627.9046754949088 L 57.85325959808887 1634.1874459949088 Z"/></g></g></g><g/><g/><g/><g/><g/><g/></g></svg>